<!DOCTYPE html>
<html>
  <head>
    <title>Kamera-Auswahl</title>
  </head>
  <body>
    <h2>Verf√ºgbare Kameras</h2>
    <button onclick="init()">Erst Kamera freigeben, dann Kameras anzeigen</button><br><br>
    <select id="cameraSelect"></select>
    <button onclick="startCamera()">Kamera starten</button><br><br>
    <video id="video" autoplay playsinline width="100%" height="auto"></video>

    <script>
      let currentStream;

      async function init() {
        try {
          // Erstmalige Kamera-Freigabe
          await navigator.mediaDevices.getUserMedia({ video: true });
          await getCameras();
        } catch (err) {
          alert('Bitte Kamera-Zugriff erlauben.');
        }
      }

      async function getCameras() {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(device => device.kind === 'videoinput');
        const select = document.getElementById('cameraSelect');
        select.innerHTML = ''; // Clear alte Optionen

        videoDevices.forEach(device => {
          const option = document.createElement('option');
          option.value = device.deviceId;
          option.text = device.label || `Kamera ${select.length + 1}`;
          select.appendChild(option);
        });
      }

      async function startCamera() {
        if (currentStream) {
          currentStream.getTracks().forEach(track => track.stop());
        }

        const deviceId = document.getElementById('cameraSelect').value;
        const constraints = {
          video: {
            deviceId: { exact: deviceId },
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        };

        try {
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          currentStream = stream;
          document.getElementById('video').srcObject = stream;
        } catch (err) {
          alert('Kamerastart fehlgeschlagen: ' + err.message);
        }
      }
    </script>
  </body>
</html>
